<!DOCTYPE html>
<html>
	<head>
		<title>Fusion Calc</title>
		<link rel='stylesheet' href='public/styles/normalize.css' />
		<link rel='stylesheet' href='public/styles/bootstrap.css' />
		<script type="text/javascript" src="public/javascripts/jquery-2.2.1.js">

		</script>
  </head>
	<body>

		<!--  Navbar -->
		<nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"> Fusion Calculator</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://forums.somethingawful.com/showthread.php?threadid=3783156">Thread</a></li>
            <!-- <li><a href="/logout/">Logout</a><li> -->
          </ul>
        </div>
      </div>
    </nav>

		<div class="container">
	    <div class="row">
	      <div class="col-xs-12">
	        <div class="panel panel-default upload-font">
						<div class="panel-body">
					    <h4>Search by card name:</h4><br>
					    <input type="text" id="cardname" onchange="searchDB()">
							<br>
							<br>
							<h4>Search by monster type:</h4>
							<br>
					    <select id="monstertype">
					        <option value="">Select Type</option>
					        <option value="Aqua">Aqua</option>
					        <option value="Beast">Beast</option>
					        <option value="Beast-Warrior">Beast-Warrior</option>
					        <option value="Dinosaur">Dinosaur</option>
					        <option value="Dragon">Dragon</option>
					        <option value="Fairy">Fairy</option>
					        <option value="Fiend">Fiend</option>
					        <option value="Fish">Fish</option>
					        <option value="Insect">Insect</option>
					        <option value="Machine">Machine</option>
					        <option value="Plant">Plant</option>
					        <option value="Pyro">Pyro</option>
					        <option value="Reptile">Reptile</option>
					        <option value="Rock">Rock</option>
					        <option value="Sea Serpent">Sea Serpent</option>
					        <option value="SpellCaster">SpellCaster</option>
					        <option value="Thunder">Thunder</option>
					        <option value="Warrior">Warrior</option>
					        <option value="Winged Beast">Winged Beast</option>
					        <option value="Zombie">Zombie</option>
					    </select><br>

					    <br>
							<h4>Search by card type:</h4>
							<br>
					    <select id="cardtype">
					        <option value="">Select Type</option>
					        <option value="Equip">Equip</option>
					        <option value="Field">Field</option>
					        <option value="Magic">Magic</option>
					        <option value="Ritual">Ritual</option>
					        <option value="Trap">Trap</option>
					    </select><br>

					    <br>
					    <button type="button" id="searchBtn">Search</button>
					    <button type="button" id="resetBtn">Reset</button>

					    <br><br>
						</div>
					</div>
				</div>
			</div>
	    <div class="row">
	      <div class="col-xs-12">
	        <div class="panel panel-default upload-font">
						<div class="panel-body">
							<h4>Results: <span id="search-msg"></span></h4>
							<div class="col-xs-6">
								<div id="outputleftarea"></div>
							</div>
							<div class="col-xs-6">
								<div id="outputrightarea"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>

    <script src="taffydb-master/taffy.js"></script>
    <script src="data/ygo_fm_cardDB.js"></script>
    <script src="data/ygo_fm_secondaryDB.js"></script>
    <script src="data/ygo_fm_genfuseDB.js"></script>
    <script>
    var searchButton = document.getElementById("searchBtn");

    var searchName = document.getElementById("cardname");
    var searchType = document.getElementById("monstertype");
    var searchCardType = document.getElementById("cardtype");

    var outputLeft = document.getElementById("outputleftarea");
		var outputRight = document.getElementById("outputrightarea");


    formatStrLeft = "<div class='result-div'>Left Input:  {left}<br>Right Input: {right}<br>Output: {output} ({attack}/{defense})</div>";

		formatStrRight = "<div class='result-div'>Left Input:  {left}<br>Right Input: {right}<br>Output: {output} ({attack}/{defense})</div>";

    function searchDB() {
				console.log("We ran the search")
        var term = "";
        var card = null;
        if (searchName.value !== "") {
            card = cardDB({name:{isnocase:searchName.value}}).first();
            // Returns an array containing the column contents, which is itself
            // an array of monster types
            var secondaries = secondaryDB({name:{isnocase:card.name}}).select("secondarytypes");
            term = [card.name, card.type].concat(secondaries[0]);
        }

        if (searchType.value !== "") {
            term = searchType.value;
        }

        if (searchCardType.value !== "") {
            term = searchCardType.value;
        }

        if (term !== "") {
            var leftfuses = genfuseDB({left:{isnocase:term}});
            if (card) {
                leftfuses =
                    leftfuses.filter({attack:{gt:card.attack}},{minattack:{lte:card.attack}});
            }
            if (leftfuses) {
                outputLeft.innerHTML = "<h2 class='center'>As Left Input</h2>"
                outputLeft.innerHTML += leftfuses.supplant(formatStrLeft);
            }
            var rightfuses = genfuseDB({right:{isnocase:term}});
            if (card) {
                rightfuses =
                    rightfuses.filter({attack:{gt:card.attack}},{minattack:{lte:card.attack}});
            }
            if (rightfuses) {
                outputRight.innerHTML += "<h2 class='center'>As Right Input</h2>"
                outputRight.innerHTML += rightfuses.supplant(formatStrRight);
            }
        } else {
            $("#search-msg").innerHTML = "Please enter a search term";
        }
    }
    searchBtn.onclick = function() { searchDB(); }
		var searchField = searchName.value;

		// runs search function on every keypress in #cardname input field
		$("#cardname").keyup(function (){
			searchType.value = "";
			searchCardType.value = "";
			outputLeft.innerHTML = "";
			outputRight.innerHTML = "";
			searchDB();
		});

    document.getElementById("resetBtn").onclick = function() {
        searchName.value = "";
        searchType.value = "";
        searchCardType.value = "";
        outputLeft.innerHTML = "";
				outputRight.innerHTML = "";
    }

    </script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	</body>
</html>
